@Test
void testIngestReportToFolder_WhenAddThrowsException_EnsuresPoolCleanup() throws Exception {
    
    when(mockPool.borrowObject()).thenReturn(mockAbstractODServer);
    when(mockAbstractODServer.addReportToFolder(any(), any(byte[].class), any(), any(), any()))
            .thenThrow(new RuntimeException("DB error"));
    
    // Use try-with-resources - it will auto-close
    try (MockedStatic<CMODConnectionManager> mockedStatic = Mockito.mockStatic(CMODConnectionManager.class)) {
        
        mockedStatic.when(() -> CMODConnectionManager.getInstance())
                  .thenAnswer(invocation -> {
                      CMODConnectionManager fakeMgr = mock(CMODConnectionManager.class);
                      Map<String, ODServerPool> poolMap = new HashMap<>();
                      poolMap.put("testPortal", mockPool);
                      when(fakeMgr.getPoolmap()).thenReturn(poolMap);
                      return fakeMgr;
                  });
        
        assertThrows(ODFailureException.class, () -> {
            odServiceNative.ingestReportToFolder(
                    "testPortal", "client", "folder",
                    "Test".getBytes(), "group", "app",
                    new String[]{}, new Hashtable<>()
            );
        });
        
        verify(mockPool).borrowObject();
        verify(mockPool).returnObject(mockAbstractODServer);
    }
}
private MockedStatic<CMODConnectionManager> staticMock;

@AfterEach
void tearDown() {
    if (staticMock != null) {
        staticMock.close();
        staticMock = null;
    }
}
